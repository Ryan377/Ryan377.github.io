<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>R Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Java并发使用线程 实现Runnable接口 实现Callable接口 继承Thread类 优先使用实现接口的方法，实现接口的方法只是一个可以在线程中运行的任务，任务是通过线程驱动执行的。  基础线程机制 Executor：用于管理多个异步任务 CachedThreadPool：一个任务创建一个线程 FixedThreadPool：所有任务只能使用固定大小的线程 SingleThreadExec">
<meta property="og:type" content="article">
<meta property="og:title" content="R Blog">
<meta property="og:url" content="http://example.com/2021/03/13/Java%E5%B9%B6%E5%8F%91/index.html">
<meta property="og:site_name" content="R Blog">
<meta property="og:description" content="Java并发使用线程 实现Runnable接口 实现Callable接口 继承Thread类 优先使用实现接口的方法，实现接口的方法只是一个可以在线程中运行的任务，任务是通过线程驱动执行的。  基础线程机制 Executor：用于管理多个异步任务 CachedThreadPool：一个任务创建一个线程 FixedThreadPool：所有任务只能使用固定大小的线程 SingleThreadExec">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gitee.com/freemansonary/markdown-pic-bed/raw/master/Typora/20210311194849.png">
<meta property="og:image" content="https://gitee.com/freemansonary/markdown-pic-bed/raw/master/Typora/20210311194952.png">
<meta property="article:published_time" content="2021-03-13T08:58:11.590Z">
<meta property="article:modified_time" content="2021-03-11T12:08:10.456Z">
<meta property="article:author" content="Rui Chen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/freemansonary/markdown-pic-bed/raw/master/Typora/20210311194849.png">
  
    <link rel="alternate" href="/atom.xml" title="R Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">R Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Java并发" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/13/Java%E5%B9%B6%E5%8F%91/" class="article-date">
  <time class="dt-published" datetime="2021-03-13T08:58:11.590Z" itemprop="datePublished">2021-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Java并发"><a href="#Java并发" class="headerlink" title="Java并发"></a>Java并发</h1><h2 id="使用线程"><a href="#使用线程" class="headerlink" title="使用线程"></a>使用线程</h2><ul>
<li>实现Runnable接口</li>
<li>实现Callable接口</li>
<li>继承Thread类</li>
<li>优先使用实现接口的方法，实现接口的方法只是一个可以在线程中运行的任务，任务是通过线程驱动执行的。</li>
</ul>
<h2 id="基础线程机制"><a href="#基础线程机制" class="headerlink" title="基础线程机制"></a>基础线程机制</h2><ul>
<li>Executor：用于管理多个异步任务<ul>
<li>CachedThreadPool：一个任务创建一个线程</li>
<li>FixedThreadPool：所有任务只能使用固定大小的线程</li>
<li>SingleThreadExecutor：相当于大小为1的FixedThreadPool</li>
</ul>
</li>
<li>Daemon：守护线程</li>
<li>sleep()：休眠当前正在执行的线程</li>
<li>yield()：声明当前线程已经完成主要任务，建议切换</li>
</ul>
<h2 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h2><ul>
<li>InterruptedException：中断时如果该线程处于阻塞、限期等待或无限期等待状态会抛出的异常，提前结束线程，但I/O阻塞和synchronized阻塞不能中断</li>
<li>Interrupted()</li>
<li>Executor的中断操作：shutdown()和shutdownNow()方法</li>
</ul>
<h2 id="互斥同步"><a href="#互斥同步" class="headerlink" title="互斥同步"></a>互斥同步</h2><ul>
<li>Synchronized：JVM提供，可以用来同步一个代码块/方法/类/静态方法</li>
<li>ReentrantLock：java.util.concurrent包中的锁（JDK实现的）</li>
<li>除非使用后者的高级功能，否则优先使用synchronized，不会产生死锁问题，JVM会确保锁的释放</li>
</ul>
<h2 id="线程之间的协作"><a href="#线程之间的协作" class="headerlink" title="线程之间的协作"></a>线程之间的协作</h2><ul>
<li>join()：在一个线程中调用另一个线程的join()方法，会挂起当前线程，直到目标线程结束</li>
<li>wait() notify() notifyAll()：调用 wait() 使得线程等待某个条件满足，线程在等待时会被挂起，当其他线程的运行使得这个条件满足时，其它线程会调用 notify() 或者 notifyAll() 来唤醒挂起的线程。（Object中的方法）</li>
<li>Await() signal() signalAll()：java.util.concurrent 类库中提供了 Condition 类来实现线程之间的协调，可以在 Condition 上调用 await() 方法使线程等待，其它线程调用 signal() 或 signalAll() 方法唤醒等待的线程。</li>
</ul>
<h2 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h2><ul>
<li>new 新建</li>
<li>Runnable 可运行</li>
<li>Blocked 阻塞（被动）</li>
<li>Waiting 无限期等待（主动）</li>
<li>Timed_waiting 限期等待（一定时间后被系统自动唤醒）</li>
<li>Terminated 死亡</li>
</ul>
<h2 id="J-U-C-AQS"><a href="#J-U-C-AQS" class="headerlink" title="J.U.C-AQS"></a>J.U.C-AQS</h2><ul>
<li>CountDownLatch：用来控制一个或多个线程等待多个线程</li>
<li>CyclicBarrier：用来控制多个线程互相等待，只有多个线程都到达了，线程才会继续执行</li>
<li>Semaphore：类似操作系统信号量，控制对互斥资源的访问</li>
</ul>
<h2 id="J-U-C-其他组件"><a href="#J-U-C-其他组件" class="headerlink" title="J.U.C-其他组件"></a>J.U.C-其他组件</h2><ul>
<li>FutureTask：可以异步获取执行结果或取消执行任务的场景</li>
<li>BlockingQueue：提供FIFO和优先级的阻塞队列实现方法，可以用于实现生产者消费者问题</li>
<li>ForkJoin：用于并行计算，类似于MapReduce</li>
</ul>
<h2 id="Java内存模型"><a href="#Java内存模型" class="headerlink" title="Java内存模型"></a>Java内存模型</h2><ul>
<li><p>主内存与工作内存</p>
<p><img src="https://gitee.com/freemansonary/markdown-pic-bed/raw/master/Typora/20210311194849.png" alt="image-20210311194849104"></p>
<p>所有变量都存储在主内存中</p>
</li>
<li><p>内存间交互操作：8个操作实现主内存和工作内存的交互</p>
<p><img src="https://gitee.com/freemansonary/markdown-pic-bed/raw/master/Typora/20210311194952.png" alt="image-20210311194952576"></p>
</li>
<li><p>内存模型三大特性</p>
<ul>
<li>原子性：上述8个操作具有原子性</li>
<li>可见性：一个线程修改共享变量的值，其他线程能够立刻得知修改（实现方式有volatile、synchronized、final）</li>
<li>有序性：本线程内观察，所有操作都是有序的；在一个线程内观察另一个线程，所有操作都是无序的</li>
</ul>
</li>
<li><p>先行发生原则：让一个操作无需控制就能先于另一个操作完成</p>
<ol>
<li>单一线程原则</li>
<li>管程锁定原则</li>
<li>volatile变量规则</li>
<li>线程启动规则</li>
<li>线程加入规则</li>
<li>线程中断规则</li>
<li>对象终结规则</li>
<li>传递性</li>
</ol>
</li>
</ul>
<h2 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h2><ul>
<li>不可变：一定线程安全，有final、String、枚举类型、Number部分子类</li>
<li>互斥同步：sychronized和ReentrantLock（阻塞同步）</li>
<li>非阻塞同步：乐观的并发策略，先执行，有冲突再补偿<ul>
<li>CAS乐观锁</li>
<li>AtomicInteger</li>
<li>ABA</li>
</ul>
</li>
<li>无同步方案：当方法不涉及共享数据时，就不用同步措施<ul>
<li>栈封闭</li>
<li>线程本地存储</li>
<li>可重入代码</li>
</ul>
</li>
</ul>
<h2 id="锁优化"><a href="#锁优化" class="headerlink" title="锁优化"></a>锁优化</h2><p>主要指JVM对synchronized的优化</p>
<ul>
<li>自旋锁：让一个线程在请求一个共享数据的锁时忙循环一段时间，若能获得锁，则可以避免阻塞状态</li>
<li>锁消除：对于检测出不可能存在竞争的共享数据的锁进行消除</li>
<li>锁粗化：若频繁对一个对象加锁解锁，则将加锁范围扩展到整个操作序列的外部</li>
<li>轻量级锁和偏向锁：JDK1.6引入</li>
</ul>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ol>
<li><p>给线程起有意义的名字</p>
</li>
<li><p>缩小同步范围</p>
</li>
<li><p>多用同步工具少用wait()和notify()</p>
</li>
<li><p>使用BlockingQueue实现生产者消费者问题</p>
</li>
<li><p>多用并发集合少用同步集合</p>
</li>
<li><p>使用本地变量和不可变类来保证安全</p>
</li>
<li><p>使用线程池而不是直接创建线程</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/13/Java%E5%B9%B6%E5%8F%91/" data-id="ckm7hypel00027cv5de4zayxs" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/03/13/Java%E5%9F%BA%E7%A1%80/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2021/03/13/%E4%B8%8A%E8%BD%A6%E9%97%AE%E9%A2%98/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/13/JVM/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/13/Java%E5%AE%B9%E5%99%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/13/Java%E5%9F%BA%E7%A1%80/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/13/Java%E5%B9%B6%E5%8F%91/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/03/13/%E4%B8%8A%E8%BD%A6%E9%97%AE%E9%A2%98/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 Rui Chen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>